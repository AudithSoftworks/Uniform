#!/usr/bin/env node
/**
 * Convert separate imates into a 3.x style theme sprite map and "less" file.
 *
 * Usage:
 *
 * 1)  `cd` into your theme's directory full of images.
 * 2)  Run `sprite-maker OUTPUT.png OUTPUT.less` to run the script.
 */

'use strict';

var inputDir, less, maker, png, promise, SpriteMaker;

SpriteMaker = require('../lib/sprite-maker');

// [0] = node
// [1] = sprite-maker
// [2] = INPUT_DIR
// [3] = PNG
// [4] = LESS
inputDir = process.argv[2];
png = process.argv[3];
less = process.argv[4];

if (!inputDir || !png || !less) {
    console.log('You must specify the input directory, output PNG file and output LESS file.')
    console.log('');
    console.log('sprite-maker INPUT_DIRECTORY/ OUTPUT.png OUTPUT.less');
    process.exit(1);
}

maker = new SpriteMaker();
promise = maker.loadImages(inputDir);
promise.then(function () {
    if (!maker.validate()) {
        throw new Error('Errors during image validation.  Please correct them.');
    }
}).then(function () {
    maker.calculateLayout();
}).then(function () {
    maker.writeSprite(png);
}).then(function () {
    maker.writeLess(less, png);
}).then(null, function (err) {
    console.log('ERROR:  ' + err.toString());
    console.log(err.stack);
    process.exit(1);
});
